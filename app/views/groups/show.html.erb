<% content_for :head do %>
  <%= render 'shared/ogp',
    title: @group.name, type: 'website',
    url: group_url(@group), image: "//#{request.host}/assets/ishikitakai.png",
    description: @group.summary %>
<% end %>

<% if @today_event.present? %>
<div class="alert alert-info">
  <h4><%= t('.today_event') %></h4>
  <div class="well">
    <%= link_to event_path(@today_event) do %>
      <h3>
        <%= @today_event.name %>
        <small>
        <%= @today_event.summary %>
        </small>
        <%= link_to event_wikis_path(@today_event), class: 'btn' do %>
          <i class="icon-align-justify"></i>
          <%= t('nav.wiki') %>
        <% end %>
        <% if user_signed_in? && !@today_event.user_is_attendence?(current_user.id) %>
          <%= link_to t('events.show.join'), my_attendence_path(@today_event), class: 'btn btn-primary', method: 'put' %>
        <% end %>
      </h3>
    <% end %>
  </div>
</div>
<% end %>

<div class="page-header">
  <span class="badge <%= css_scope_badge(@group.scope) %>"><%= @group.scope.label %></span>
  <h1>
    <%= @group.name %>
    <small><%= @group.summary %></small>
  </h1>
</div>

<section>
<div class="markdown">
  <%= @group.content.html_safe %>
</div>
</section>

<% if @group.user_can_edit?(current_user) %>
  <section class="form-actions">
    <%= link_to t('events.index.new'), new_event_path(group_id: @group.id), class: "btn btn-warning" %>
    <%= link_to t('.edit'), edit_group_path(@group), class: 'btn' %>
  </section>
<% end %>

<% content_for_sidebar do %>
  <div class="form-action">
    <% if user_signed_in? && @group.user_is_member?(current_user.id) %>
      <%= link_to group_chats_path(@group), class: 'btn btn-block' do %>
        <i class="icon-comment"></i>
        <%= t('nav.chat') %>
      <% end %>
      <%= link_to group_tasks_path(@group), class: 'btn btn-block' do %>
        <i class="icon-ok"></i>
        <%= t('nav.task') %>
      <% end %>
      <%= link_to group_wikis_path(@group), class: 'btn btn-block' do %>
        <i class="icon-align-justify"></i>
        <%= t('nav.wiki') %>
      <% end %>
      <%= link_to group_kpts_path(@group), class: 'btn btn-block' do %>
        <%= t('nav.kpt') %>
      <% end %>
    <% else %>
      <%= link_to t('.join'), group_memberships_path(@group), class: 'btn btn-primary btn-block', method: 'post' %>
    <% end %>
  </div>
  <section>
  <h3><i class="icon-user"></i><%= t('.member') %><i class="icon-user"></i></h3>
  <table class="table table-condensed">
    <% @group.memberships.order(:level_id, :id).each do|membership| %>
        <td><span class="label <%= css_level_badge(membership.level) %>"><%= membership.level.label %></span></td>
        <td><%= link_to membership.user.name, user_path(membership.user_id) %></td>
      </tr>
    <% end %>
  </table>
  </section>
  <% if user_signed_in? && @group.user_is_member?(current_user.id) %>
    <% unless @group.user_is_owner?(current_user.id) %>
      <%= link_to t('.leave'), my_membership_path(@group), class: 'btn btn-danger btn-block', confirm: t('.confirm_leave'), method: 'delete' %>
    <% end %>
  <% end %>
<% end %>

<hr />

<% content_for :body_class,  "group events" %>
<ul class="thumbnails row">
  <% @group.events.limit(6).order('begin_at DESC').each do|event| %>
    <li class="span3"><%= render 'events/event', event: event, show_group: false %></li>
  <% end %>
</ul> 

<%= link_to t('.all_events'), events_path(group_id: @group.id), class: 'more_events' %>
